void function(n,e){var t=n.module("flowthings",[]);t.provider("ftRequest",function(){var n=this;n.options={host:"api.flowthings.io",version:"0.1",secure:true};n.$get=["$http","$q",function(e,t){return function(t,r,o,u,i){var s=c&&c.timeout;var f=c&&c.cache;var a=l(t,o,n.options);var c=b(i);var h=p(t);var d=e({url:a,method:r,data:u,params:c,timeout:s,cache:f,headers:h});return d.then(function(n){if(c.refs){return[n.data.body,n.data.head.references]}else{return n.data.body}})}}]});t.value("ftWebSocketBackend",e.WebSocket);t.provider("ftWebSocket",function(){var n=this;n.options={host:"ws.flowthings.io",secure:true};n.$get=["$http","$q","ftWebSocketBackend",function(e,t,r){return function(t){var o=e({url:h("http",n.options),headers:p(t),method:"POST"});return o.then(function(e){return new r(h("ws",n.options)+"/"+e.data.body.id+"/ws")})}}]});t.provider("flowthings",function(){var e=this;e.options={account:null,token:null};e.$get=["ftRequest","ftWebSocket","$timeout","$q","$rootScope",function(t,u,i,s,f){function a(n,e){return f.$broadcast("flowthings:"+n,e)}function c(n){return f.$apply(n)}return n.extend(r(e.options,t),o(e.options,u,a,i,s,c))}]});function r(e,t){var r=t.bind(null,e);return{request:r,flow:f(r,"/flow",[u]),drop:n.extend(a(r,"/drop",[u,s]),f(r,"/drop",[i]))}}function o(e,t,r,o,u,i){var s=null;var f={};var a={};var c=[];var l=false;var h=1;var p;var v={connect:b,subscribe:g,send:w,$$receive:y,$$flush:$};function b(){if(l){u.when(v)}return t(e).then(function(n){s=n;s.onopen=function(){l=true;p=o(k,3e4,false);$();i(function(){r("open",v)})};s.onmessage=function(n){y(n.data)};s.onerror=function(){m();i(function(){r("error")})};s.onclose=function(n){m();i(function(){r("close",n)})};v.$$socket=s;return v})}function g(e,t,r){var o;var u=r?r.$on("$destroy",i):n.noop;function i(){if(f[e]){f[e].subs=f[e].subs.filter(function(n){return n!==t});if(f[e].subs.length===0){delete f[e];w(d("drop","unsubscribe",e))}}u()}if(f.hasOwnProperty(e)){o=f[e]}else{o=f[e]=w(d("drop","subscribe",e));o.subs=[]}return{unsubscribe:i,result:o.then(function(){if(f[e]){f[e].subs=f[e].subs.concat(t)}})}}function $(){while(c.length){c.shift()()}}function w(e,t){var r;if(t!==false){var o=h++;r=a[o]=u.defer();e=n.extend({},e,{msgId:o})}function i(){s.send(n.toJson(n.extend({},e,{msgId:o})))}if(l){i()}else{c.push(i)}return r&&r.promise}function y(e){var t=JSON.parse(e);if(t.type==="message"){i(function(){function e(n){n(t.value)}if(f.hasOwnProperty(t.value.flowId)){n.forEach(f[t.value.flowId].subs,e)}if(f.hasOwnProperty(t.value.path)){n.forEach(f[t.value.path].subs,e)}})}else{var r=t.head.msgId;if(a.hasOwnProperty(r)){i(function(){if(t.head.ok){a[r].resolve(t.body)}else{a[r].reject(t)}delete a[r]})}}}function m(){var e=a;o.cancel(p);l=false;s=null;f={};a={};c=[];h=1;n.forEach(e,function(n,e){n.reject(new Error("Connection interrupted"))})}function k(){if(s){w({type:"heartbeat"},false);p=o(k,3e4,false)}}return v}function u(e){function t(n,t){return e("GET","/"+n,null,t)}function r(n,t){return e("MGET","",n,t)}function o(n){return e("GET","",null,n)}function u(e,u){if(n.isString(e)){return t(e,u)}if(n.isArray(e)){return r(e,u)}return o(e)}return{read:t,readMany:r,findMany:o,find:u}}function i(n){function e(e,t){return n("POST","",e,t)}return{create:e}}function s(e){var t=i(e);function r(n,t){return e("PUT","/"+n.id,n,t)}function o(n,e){if(n.id){return r(n,e)}return t.create(n,e)}return n.extend(t,{update:r,save:o})}function f(e,t,r){var o={};n.forEach(r,function(r){n.extend(o,r(c(e,t)))});return o}function a(n,e,t){return function(r){return f(n,e+"/"+r,t)}}function c(n,e){return function(t,r,o,u){return n(t,e+r,o,u)}}function l(n,e,t){return(t.secure?"https":"http")+"://"+t.host+"/v"+t.version+"/"+n.account+e}function h(n,e){return n+(e.secure?"s":"")+"://"+e.host+"/session"}function p(n){return{"X-Auth-Account":n.account,"X-Auth-Token":n.token}}function d(n,e,t){var r={object:n,type:e};if(t.charAt(0)==="/"){r.path=t}else{r.flowId=t}return r}var v={timeout:true,cache:true};function b(e){var t={};n.forEach(e,function(e,r){if(v.hasOwnProperty(r)){return}switch(r){case"only":if(n.isArray(e)){e=e.join(",")}break;case"refs":e=e?1:0;break;case"filter":if(!n.isString(e)){e=g(e)}break}t[r]=e});return t}function g(e){var t=[];n.forEach(e,function(e,r){if(r==="$and"){t.push([e.map(g).join("&&")])}else if(r==="$or"){t.push([e.map(g).join("||")])}else if(y(e)){t.push([r,"=~",$(e)])}else if(e.hasOwnProperty("$regex")){t.push([r,"=~",w(e.$regex)])}else if(e.hasOwnProperty("$lt")){t.push([r,"<",n.toJson(e.$lt)])}else if(e.hasOwnProperty("$lte")){t.push([r,"<=",n.toJson(e.$lte)])}else if(e.hasOwnProperty("$gt")){t.push([r,">",n.toJson(e.$gt)])}else if(e.hasOwnProperty("$gte")){t.push([r,">=",n.toJson(e.$gte)])}else{t.push([r,"==",n.toJson(e)])}});return t.map(function(n){return"("+n.join(" ")+")"}).join("&&")}function $(n){var e=n.source;var t="";if(n.global){t+="g"}if(n.ignoreCase){t+="i"}if(n.multiline){t+="m"}return"/"+e+"/"+t}function w(e){var t,r;if(n.isArray(e)){t=reg[0];r=reg[1]||""}else{t=e;r=""}return"/"+t.replace(/\//g,"\\/")+"/"+r}function y(n){return typeof n==="object"&&Object.prototype.toString.call(n)==="[object RegExp]"}}(angular,window);